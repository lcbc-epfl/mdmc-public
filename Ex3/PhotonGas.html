
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The Photon Gas &#8212; Molecular Dynamics and Monte Carlo</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"ket": ["\\lvert #1 \\rangle", 1], "bra": ["\\langle #1 \\lvert", 1], "Ket": ["\\lvert #1 \\rangle", 1], "Bra": ["\\langle #1 \\lvert", 1], "braket": ["\\langle #1 \\lvert #2 \\rangle", 2], "hop": "\\hat{\\mathcal{H}}", "unit": "\\mathbbm{1}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Ex3/PhotonGas';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Lennard-Jones Potential" href="LJ_NVT.html" />
    <link rel="prev" title="Theory" href="Ex3_Theory.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Molecular Dynamics and Monte Carlo</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ex1/MDMC_Ex1.html">Basic Concepts of Molecular Dynamics and Monte Carlo Simulations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ex1/Ex1_Theory.html">From Quantum to Classical Mechanics: The Example of Forces</a></li>

<li class="toctree-l2"><a class="reference internal" href="../Ex1/MonteCarloPI.html">Monte Carlo <span class="math notranslate nohighlight">\(\pi\)</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ex1/prng.html">Appendix: Random and Pseudo-random Numbers</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ex2/MDMC_ex2.html">Statistical Thermodynamics and the Boltzmann Distribution</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ex2/Ex2_Theory.html">Statistical Thermodynamics and the Boltzmann Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ex2/Boltzmann.html">Boltzmann Distribution Harmonic Oscillator</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="MDMC_ex3.html">Monte Carlo Simulations and the Photon Gas</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Ex3_Theory.html">Theory</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">The Photon Gas</a></li>
<li class="toctree-l2"><a class="reference internal" href="LJ_NVT.html">The Lennard-Jones Potential</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ex4/MDMC_ex4.html">Introduction to Molecular Dynamics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ex4/Theory.html">Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ex4/Exercise.html">MD simulation from scratch</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ex5/MDMC_ex5.html">Classical Molecular Dynamics (MD) Simulations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ex5/theory.html">Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ex5/Exercise.html">ToyMD</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ex6/MDMC_ex6.html">Properties from Molecular Dynamics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ex6/theory.html">Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ex6/proteinmodelling.html">Protein Modelling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ex6/TRP_Cage.html">Practical: TRP Cage using OpenMM</a></li>

</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://noto.epfl.ch/hub/user-redirect/git-pull?repo=https%3A//github.com/lcbc-epfl/mdmc-public&urlpath=lab/tree/mdmc-public/mdmc/Ex3/PhotonGas.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/lcbc-epfl/mdmc-public" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/lcbc-epfl/mdmc-public/issues/new?title=Issue%20on%20page%20%2FEx3/PhotonGas.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Ex3/PhotonGas.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Photon Gas</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ensemble-averages-from-the-metropolis-monte-carlo-algorithm">Ensemble Averages from the Metropolis Monte Carlo Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-a-metropolis-monte-carlo-algorithm">Implementing a Metropolis Monte Carlo Algorithm</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-photon-gas">
<h1>The Photon Gas<a class="headerlink" href="#the-photon-gas" title="Link to this heading">#</a></h1>
<p>Note: This exercise was updates compared to previous years.</p>
<p>This exercise gives you an example of a Metropolis Monte Carlo algorithm, where you will apply this type of algorithm to calculate the state occupancy of vibrational states of a <span class="math notranslate nohighlight">\(H_2\)</span> gas. In this exercise, we will approximate the vibrations with the harmanic oscillator. The resulting system is a set of harmonic oscillators in different energy levels.</p>
<section id="ensemble-averages-from-the-metropolis-monte-carlo-algorithm">
<h2>Ensemble Averages from the Metropolis Monte Carlo Algorithm<a class="headerlink" href="#ensemble-averages-from-the-metropolis-monte-carlo-algorithm" title="Link to this heading">#</a></h2>
<p>The ensemble average of the state occupancy <span class="math notranslate nohighlight">\(\left&lt;N_i\right&gt;\)</span> of state <span class="math notranslate nohighlight">\(i\)</span> of an ensemble of harmonic oscillators can be calculated analytically. In the canonical ensemble, the ensemble average occupancy of state <span class="math notranslate nohighlight">\(i\)</span> is expressed as:</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
    \langle N_i\rangle = P_i * N = \frac{e^{-E_i\beta}}{Z}N
\end{align}
\]</div>
<p>where <span class="math notranslate nohighlight">\(Z\)</span> is the partition function of an ensemble of harmonic oscillators.</p>
<p>We can express the energy of a set of <span class="math notranslate nohighlight">\(N\)</span> harmonic oscillators with the same frequency <span class="math notranslate nohighlight">\(\omega\)</span> as:</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
    E_{\{N_i\}} = \sum_i^N N_i \hbar \omega (n_i+\frac12)
\end{align}
\]</div>
<p>We will use this expression as part of the Metropolis Monte Carlo algorithm to obtain the state occupancy of our ensemble of harmoinic oscillators.</p>
<p>The scheme you will employ is as follows:</p>
<ol class="arabic">
<li><p>Start with an arbitrary set of <span class="math notranslate nohighlight">\(\{N_i\}\)</span>, here we will start with all of them in the ground state.</p></li>
<li><p>Decide to perform a trial move for one random harminic oscillator to randomly move it to a higher or lower energy level (we limit the move to <span class="math notranslate nohighlight">\(\pm 1\)</span> energy level).</p></li>
<li><p>Accept the trial move with probability (i.e. perform a Metropolis Monte Carlo move):</p>
<div class="math notranslate nohighlight">
\[
    \begin{aligned}
    P_{acc}(o \rightarrow n)= \min \left(1, e^{-\beta(E(n)-E(o))}\right),\end{aligned}
    \]</div>
<p>where <span class="math notranslate nohighlight">\(E(n)\)</span> and <span class="math notranslate nohighlight">\(E(o)\)</span> are the energies of the new and old ensemble of harmonic oscillators respectively.</p>
</li>
<li><p>Update averages regardless of acceptance or rejection.</p></li>
<li><p>Iterate from 2).</p></li>
</ol>
<p><strong>Note</strong> that you will need to find the value of <span class="math notranslate nohighlight">\(\hbar \omega\)</span> for a <span class="math notranslate nohighlight">\(H_2\)</span> gas.</p>
</section>
<section id="implementing-a-metropolis-monte-carlo-algorithm">
<h2>Implementing a Metropolis Monte Carlo Algorithm<a class="headerlink" href="#implementing-a-metropolis-monte-carlo-algorithm" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">r</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">m</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> 

<span class="c1">#from ipywidgets import interact, interactive, fixed, interact_manual</span>
<span class="c1">#import ipywidgets as widgets</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
<span class="c1">#import helpers</span>
<span class="c1">#helpers.set_style()</span>

<span class="c1"># Random Seed</span>
<span class="n">r</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 3</p>
<p>To express the occupation of our ensemble of harmonic ascillators, we will use a list where each item is the number of particle in the corresponding level. For example occupancy[0]=10 means that there are 10 particles in the ground state (level 0)
Create a function that calculates the energy of an occupancy list using the hints provided.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">energy</span><span class="p">(</span><span class="n">occupancy</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">):</span>
    <span class="c1"># Loop over the energy levels</span>
    <span class="c1"># For each energy level, calculate the energy using the expression provided in the introduction (you will use hbaromega and n, the number of particles in that energy level)</span>
    <span class="c1"># Add it to the total energy</span>
    <span class="k">return</span> <span class="n">total_energy</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 4</p>
<p>Make modifications in the code, right after the commented section <code class="docutils literal notranslate"><span class="pre">MODIFICATION</span> <span class="pre">...</span> <span class="pre">END</span> <span class="pre">MODIFICATION</span></code>. Include the entire code within your report and comment upon the part that you wrote.</p>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 5</p>
<p>How can this scheme retain detailed balance when <span class="math notranslate nohighlight">\(N_i = 0\)</span>? Note that <span class="math notranslate nohighlight">\(N_i\)</span>  cannot be negative.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This function is given to you and we will use to randomly pick a level from a list of all levels available.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_level</span><span class="p">(</span><span class="n">occupancy</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">occupancy</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="n">cumulative_occupancy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">occupancy</span><span class="p">)</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_occupancy</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">level</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input the correct values here, for a di-hydrogen gas at room temperature.</span>
<span class="n">numberOfIterations</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">T</span> <span class="o">=</span> <span class="c1"># FILL IN K</span>
<span class="n">omega</span> <span class="o">=</span> <span class="c1"># FILL IN cm-1</span>
<span class="n">levels</span><span class="o">=</span><span class="mi">100</span>
<span class="n">n</span><span class="o">=</span><span class="mi">40</span>

<span class="c1"># Constants</span>
<span class="n">kb</span><span class="o">=</span><span class="mf">1.4</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">23</span>
<span class="n">hbar</span> <span class="o">=</span> <span class="mf">1.05</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">34</span>

<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">kb</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>
<span class="n">hbaromega</span> <span class="o">=</span> <span class="n">hbar</span><span class="o">*</span><span class="n">omega</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span> <span class="c1"># We convert cm-1 to SI units by multiplying by the speed of ligth in cm/s</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculateOccupancy</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">,</span><span class="n">numberOfIterations</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>

    <span class="c1"># We create an occupancy vector to keep track of how many particles are in each level.</span>
    <span class="n">occupancy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="n">occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># We put all the particles in the ground state</span>
    <span class="n">occupancy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>

    <span class="c1"># This occupancy_sum array is there to collect the statistics of the occupation</span>
    <span class="n">occupancy_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">occupancy</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfIterations</span><span class="p">):</span>
        <span class="c1"># Create new_occupancy, which is a copy of the current occupancy, to store the new occupancy after performing a trial move.</span>
        <span class="n">new_occupancy</span> <span class="o">=</span> <span class="n">occupancy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># We select from which level to move a particle</span>
        <span class="n">initial_level</span> <span class="o">=</span> <span class="n">select_level</span><span class="p">(</span><span class="n">occupancy</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;  MODIFICATION</span>
<span class="sd">    Metropolis algorithm implementation to calculate {N_i}</span>
<span class="sd">    Tasks:</span>
<span class="sd">    1) Loop from int i = 0 to numberOfiterations (this was done above)</span>
<span class="sd">    2) Randomy select from which level (initial_level) to move a particle by using the select_level function provided to you. (this was done above)</span>
<span class="sd">    (modifications start here)</span>
<span class="sd">    3) Call r.randint(0,1) to perform a trial move to move the particle from a higher or lower level (final_level = initial_level +/- 1). </span>
<span class="sd">        Note: randint(0,1) returns random integers from 0 to 1 (i.e. 0 OR 1)</span>
<span class="sd">               but you need to extract -1 OR 1</span>
<span class="sd">        Hint:   what happens to the extraction if you multiply r.randint(0,1)*A, where A is an integer?</span>
<span class="sd">                what happens to the extraction if you sum r.randint(0,1)+B, where B is an integer (positive or negative)?</span>
<span class="sd">                The above hints shall suggest how to obtain the desired numbers from the extraction of 0 or 1</span>
<span class="sd">    4) Test if final_level &lt; 0, if it is, force it to be 0</span>
<span class="sd">    5) Test if final_level &gt; levels-1, if it is, force it to be levels-1: by adding these lines:</span>
<span class="sd">            if final_level &gt; levels-1:</span>
<span class="sd">                final_level = levels-1</span>
<span class="sd">    5) Update the initial_level and final_level of new_occupancy so that the number of particles in initial_level is decreased by 1, </span>
<span class="sd">        and the number of particles in final_level is increased by 1.</span>
<span class="sd">    5) Accept the trial move with probability defined in the Theory section</span>
<span class="sd">        Note: Accepting the trial move means updating the occupancy (old_occupancy).</span>
<span class="sd">        with the new occupancy (new_occupancy);</span>
<span class="sd">    6) sum occupancy to occupancy_sum to kkeep track of the statistics</span>
<span class="sd">    7) Average the occupancy_sum by the number of iterations to compute the average occupancy after numberOfiterations iterations</span>

<span class="sd">    END MODIFICATION</span>
<span class="sd">    &quot;&quot;&quot;</span>

        <span class="c1"># Call r.randint(0,1) to perform a trial move to move the particle from a higher or lower level</span>

        <span class="c1"># check that the level to move the particle to is allowed by our problem</span>

        <span class="k">if</span> <span class="n">final_level</span> <span class="o">&gt;</span> <span class="n">levels</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">final_level</span> <span class="o">=</span> <span class="n">levels</span><span class="o">-</span><span class="mi">1</span>

        <span class="c1"># update the occupancy the inital and final level</span>

        <span class="c1"># check the Metropolis acceptance criterion</span>
        
        <span class="c1"># sum occupancy</span>

    <span class="c1"># average sum_occupancy by number of iterations</span>

    <span class="k">return</span> <span class="n">avg_occupancy</span>

<span class="c1"># perform a single calculation</span>
<span class="n">estimatedOccupancy</span> <span class="o">=</span> <span class="n">calculateOccupancy</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">,</span><span class="n">numberOfIterations</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 6 - Bonus</p>
<p>Bonus: Why do we add these lines in our code:
if final_level &gt; levels-1:
final_level = levels-1
How is this realted to the number of levels?</p>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 7</p>
<p>Using your code, plot the average occupancy.
Do it for two different temperatures and comment on your observations.
Calculate the anyltical solution with the expression in the theory above and the partition function for a harmonic oscillator.</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
    Z = \frac{e^{\frac12 \beta \hbar \omega}}{e^{\beta \hbar \omega}-1}
\end{align}
\]</div>
<p>Plot your calculated values versus those from the analytical solution (two curves in the same plot) and include your curve in your report (you will include 2 plts, one for each temperature chosen).</p>
<p>Now, do the same process with 3 or more values for numberOfIterations.
What is the influence of the number of MC iterations on the estimated result vs the analytical one? Why? Justify in words and include supporting plots.</p>
<p>Note: this question requires more time, you need to clearly justify your statements.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the 2 temperatures</span>
<span class="n">T1</span> <span class="o">=</span> <span class="c1"># FILL IN K</span>
<span class="n">T2</span> <span class="o">=</span> <span class="c1">#FILL IN K</span>
<span class="n">beta_1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">kb</span><span class="o">*</span><span class="n">T1</span><span class="p">)</span>
<span class="n">beta_2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">kb</span><span class="o">*</span><span class="n">T2</span><span class="p">)</span>
<span class="n">numerOfIterations</span><span class="o">=</span> <span class="c1"># fill here with different values to study the influence of this variable on the results.</span>

<span class="c1"># run the Metropolis algorithm for each T</span>
<span class="n">estimatedOccupancy_1</span> <span class="o">=</span> <span class="n">calculateOccupancy</span><span class="p">(</span><span class="n">beta_1</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">,</span><span class="n">numberOfIterations</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">estimatedOccupancy_2</span> <span class="o">=</span> <span class="n">calculateOccupancy</span><span class="p">(</span><span class="n">beta_2</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">,</span><span class="n">numberOfIterations</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># analytical function</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_analytic_occupancy</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="c1"># calculate the partition function Z</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">hbaromega</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">hbaromega</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># calculate the occupancy of each level using the expression provided in the introduction and append it to a list</span>
    <span class="n">analytic_occupancy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="n">analytic_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">hbaromega</span><span class="o">*</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">/</span><span class="n">Z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">analytic_occupancy</span>

<span class="c1"># Calculate analytical occupancy for each T</span>
<span class="n">analytical_occupancy_1</span><span class="o">=</span><span class="n">calculate_analytic_occupancy</span><span class="p">(</span><span class="n">beta_1</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">analytical_occupancy_2</span><span class="o">=</span><span class="n">calculate_analytic_occupancy</span><span class="p">(</span><span class="n">beta_2</span><span class="p">,</span><span class="n">hbaromega</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="n">analytical_occupancy_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;analytical T1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="n">estimatedOccupancy_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;estimated T1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="n">analytical_occupancy_2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;analytical T2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="n">estimatedOccupancy_2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;estimated T2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Level&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Occupancy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 8</p>
<p>Why does ignoring rejected moves lead to erroneous results? <em>Hint</em>: define <span class="math notranslate nohighlight">\(P'(o \rightarrow o)\)</span> (<em>i.e</em>  the probability that you stay in the old configuration) and recall that the transition probability <span class="math notranslate nohighlight">\(P'\)</span> is normalised.</p>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 9 - Bonus</p>
<p>Based on your comprehension of the exercise, what do you think is the influence of the number of partciples?</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "compchem"
        },
        kernelOptions: {
            name: "compchem",
            path: "./Ex3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'compchem'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Ex3_Theory.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Theory</p>
      </div>
    </a>
    <a class="right-next"
       href="LJ_NVT.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Lennard-Jones Potential</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ensemble-averages-from-the-metropolis-monte-carlo-algorithm">Ensemble Averages from the Metropolis Monte Carlo Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-a-metropolis-monte-carlo-algorithm">Implementing a Metropolis Monte Carlo Algorithm</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Laboratory of Computational Biochemistry and Chemistry - Ursula Roethlisberger
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>