
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6.4. Practical: TRP Cage using OpenMM &#8212; Molecular Dynamics and Monte Carlo</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.5. TrpCage Analysis" href="hydrogenbonds.html" />
    <link rel="prev" title="6.3. Protein Modelling" href="proteinmodelling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Molecular Dynamics and Monte Carlo</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Molecular Dynamics and Monte Carlo
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Exercises
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Ex1/MDMC_ex1.html">
   1. Basic Concepts of Molecular Dynamics and Monte Carlo Simulations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex1/Exercise1Theory.html">
     1.1. From Quantum to Classical Mechanics: The Example of Forces
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex1/MonteCarloPI.html">
     1.3. Monte Carlo Pi Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex1/prng.html">
     1.4. Appendix: Random and Pseudo-random Numbers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Ex2/MDMC_ex2.html">
   2. Statistical Thermodynamics and the Boltzmann Distribution
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex2/Exercise2Theory.html">
     2.1. Statistical Thermodynamics and the Boltzmann Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex2/Exercise2TheoryQ.html">
     2.2. Theory Questions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex2/Boltzmann_new.html">
     2.3. Boltzmann levels python
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Ex3/MDMC_ex3.html">
   3. Monte Carlo Simulations and the Photon Gas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex3/Exercise3Theory.html">
     3.1. Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex3/Photon.html">
     3.2. Practical: Photon gas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex3/MC_NVT.html">
     3.3. Configurational sampling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Ex4/MDMC_ex4.html">
   4. Introduction to Molecular Dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex4/theory.html">
     4.1. Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex4/Exercise.html">
     4.2. How to run the exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Ex5/MDMC_ex5.html">
   5. Classical Molecular Dynamics (MD) Simulations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex5/theory.html">
     5.1. Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex5/Exercise.html">
     5.2. ToyMD NVT
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="MDMC_Ex6.html">
   6. Properties from Molecular Dynamics
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="theory.html">
     6.1. Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="proteinmodelling.html">
     6.3. Protein Modelling
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     6.4. Practical: TRP Cage using OpenMM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hydrogenbonds.html">
     6.5. TrpCage Analysis
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Ex6/TRP_Cage_OpenMM_colab.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/lcbc-epfl/mdmc-public"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/lcbc-epfl/mdmc-public/issues/new?title=Issue%20on%20page%20%2FEx6/TRP_Cage_OpenMM_colab.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        <a class="jupyterhub-button" href="https://noto.epfl.ch/hub/user-redirect/git-pull?repo=https://github.com/lcbc-epfl/mdmc-public&urlpath=lab/tree/mdmc-public/mdmc/Ex6/TRP_Cage_OpenMM_colab.ipynb&branch=main"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/lcbc-epfl/mdmc-public/blob/main/mdmc/Ex6/TRP_Cage_OpenMM_colab.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   6.4.1. Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-our-system">
   6.4.2. Creating our system
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#looking-at-the-starting-structure">
     6.4.2.1. Looking at the starting structure
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulating-the-system">
   6.4.3. Simulating the system
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-amber-files">
     6.4.3.1. Loading Amber files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-openmm-system">
     6.4.3.2. Create the OpenMM System
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-integrator-to-do-langevin-dynamics">
     6.4.3.3. Create the integrator to do Langevin Dynamics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-simulation-object">
     6.4.3.4. Create the
     <code class="docutils literal notranslate">
      <span class="pre">
       Simulation
      </span>
     </code>
     object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#minimize-the-energy">
     6.4.3.5. Minimize the energy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#heating-phase">
     6.4.3.6. Heating phase
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-dynamics">
   6.4.4. Running dynamics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#save-trajectory-for-later-processing">
   6.4.5. Save trajectory for later processing
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><strong>Note</strong> This tutorial should be run on Google Colab and not on JupyterHub.</p>
<p>Change the runtime to use a GPU by selecting <code class="docutils literal notranslate"><span class="pre">Runtime</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Change</span> <span class="pre">Runtime</span> <span class="pre">type</span></code> -&gt; select <code class="docutils literal notranslate"><span class="pre">GPU</span></code></p>
<div class="tex2jax_ignore mathjax_ignore section" id="practical-trp-cage-using-openmm">
<h1><span class="section-number">6.4. </span>Practical: TRP Cage using OpenMM<a class="headerlink" href="#practical-trp-cage-using-openmm" title="Permalink to this headline">¶</a></h1>
<p>We will use a modern and open source simulation program to run our molecular dynamics simulation of the TRP cage protein.</p>
<p>OpenMM is different from most other simulations tools in that it is not controlled by executing different subprograms in the command line but instead one uses a python program to control the flow of our simulation. This allows us to easily rerun parts or the whole simulation.</p>
<p>Below is a detailed description of our workflow. The respective parts you need to change during the exercise are indicated.</p>
<div class="section" id="imports">
<h2><span class="section-number">6.4.1. </span>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<p>First we need to install the necessary modules and import them.  We install our simulation package openmm and parmed, which we use to load our Amber trajectory files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment below code on Colab</span>

<span class="c1">#!pip install -q condacolab</span>
<span class="c1">#import condacolab</span>
<span class="c1">#condacolab.install()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>⏬ Downloading https://github.com/jaimergp/miniforge/releases/latest/download/Mambaforge-colab-Linux-x86_64.sh...
📦 Installing...
📌 Adjusting configuration...
🩹 Patching environment...
⏲ Done in 0:00:33
🔁 Restarting kernel...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment on google colab </span>

<span class="c1">#!conda install openmm ambertools=20 &amp;&gt; /dev/null  </span>
<span class="c1"># The last part simply makes the command silent. Remove &amp;&gt; /dev/null  if there are problems</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="ex1">
<p class="admonition-title">Exercise 1</p>
<p>Follow the instructions in this file and run the folding simulation.
Calculate the correct number of steps for the simulations to run 50 ps of heating and 20 ns of dynamics and report those numbers in your report. These sections are marked in the following with <code class="docutils literal notranslate"><span class="pre">#CHANGE</span> <span class="pre">HERE</span></code>.</p>
</div>
</div>
<div class="section" id="creating-our-system">
<h2><span class="section-number">6.4.2. </span>Creating our system<a class="headerlink" href="#creating-our-system" title="Permalink to this headline">¶</a></h2>
<p>Creating the system will be done using tleap which is part of the Amber software package. Linear peptides can be easily created using this tool.</p>
<p>Below we create this file using python and save it as <code class="docutils literal notranslate"><span class="pre">leap.in</span></code> to the filesystem.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">!cat</span> <span class="pre">filename</span></code> we can check whether it was sucessfully created.</p>
<p>Then we execute tleap using our input file using the command <code class="docutils literal notranslate"><span class="pre">!tleap</span> <span class="pre">-f</span> <span class="pre">leap.in</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">leapin</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;source leaprc.protein.ff19SB</span>
<span class="s2">  set default PBradii mbondi3</span>
<span class="s2">  TRP = sequence {  NASN LEU TYR ILE GLN TRP LEU LYS ASP GLY GLY PRO SER SER GLY ARG PRO PRO PRO CSER}</span>
<span class="s2">  savepdb TRP trp_cage_linear.pdb</span>
<span class="s2">  saveamberparm TRP trp_cage.prmtop trp_cage_linear.nc</span>
<span class="s2">  quit</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;leap.in&quot;</span><span class="p">,</span><span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">leapin</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat leap.in
</pre></div>
</div>
</div>
</div>
<div class="section" id="looking-at-the-starting-structure">
<h3><span class="section-number">6.4.2.1. </span>Looking at the starting structure<a class="headerlink" href="#looking-at-the-starting-structure" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show starting structure here</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="ex2">
<p class="admonition-title">Exercise 2</p>
<p>Include an image of the starting structure in your report. Are there any residues which  would contribute to the instability of the starting structure in its current conformation, why?</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tleap -f leap.in
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-I: Adding /usr/local/dat/leap/prep to search path.
-I: Adding /usr/local/dat/leap/lib to search path.
-I: Adding /usr/local/dat/leap/parm to search path.
-I: Adding /usr/local/dat/leap/cmd to search path.
-f: Source leap.in.

Welcome to LEaP!
(no leaprc in search path)
Sourcing: ./leap.in
----- Source: /usr/local/dat/leap/cmd/leaprc.protein.ff19SB
----- Source of /usr/local/dat/leap/cmd/leaprc.protein.ff19SB done
Log file: ./leap.log
Loading parameters: /usr/local/dat/leap/parm/parm19.dat
Reading title:
PARM99 + frcmod.ff99SB + frcmod.parmbsc0 + OL3 for RNA + ff19SB
Loading parameters: /usr/local/dat/leap/parm/frcmod.ff19SB
Reading force field modification type file (frcmod)
Reading title:
ff19SB AA-specific backbone CMAPs for protein 07/25/2019
Loading library: /usr/local/dat/leap/lib/amino19.lib
Loading library: /usr/local/dat/leap/lib/aminoct12.lib
Loading library: /usr/local/dat/leap/lib/aminont12.lib
Using ArgH and AspGluO modified Bondi2 radii
Writing pdb file: trp_cage_linear.pdb

/usr/local/bin/teLeap: Warning!
 Converting N-terminal residue name to PDB format: NASN -&gt; ASN

/usr/local/bin/teLeap: Warning!
 Converting C-terminal residue name to PDB format: CSER -&gt; SER
Checking Unit.

/usr/local/bin/teLeap: Warning!
The unperturbed charge of the unit (1.000000) is not zero.

/usr/local/bin/teLeap: Note.
Ignoring the warning from Unit Checking.

Building topology.
Building atom parameters.
Building bond parameters.
Building angle parameters.
Building proper torsion parameters.
Building improper torsion parameters.
 total 63 improper torsions applied
Building H-Bond parameters.
Incorporating Non-Bonded adjustments.
Not Marking per-residue atom chain types.
Marking per-residue atom chain types.
  (Residues lacking connect0/connect1 - 
   these don&#39;t have chain types marked:

	res	total affected

	CSER	1
	NASN	1
  )
 (no restraints)

&gt; ^C
</pre></div>
</div>
</div>
</div>
<p>You will be greeted with plenty output, lets go through it step by step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;$ tleap
-I: Adding /home/packages/amber20/dat/leap/prep to search path.
-I: Adding /home/packages/amber20/dat/leap/lib to search path.
-I: Adding /home/packages/amber20/dat/leap/parm to search path.
-I: Adding /home/packages/amber20/dat/leap/cmd to search path.
Welcome to LEaP!
&gt;(no leaprc in search path)
</pre></div>
</div>
<p>This is leap starting up telling us that it has added several directories to its search path. These directories contain the parameters of the amber force field that we now will load.</p>
<p>Next we need to load a specific force field.
We do this using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">leaprc</span><span class="o">.</span><span class="n">protein</span><span class="o">.</span><span class="n">ff19SB</span>
</pre></div>
</div>
<p>If you want you can take a look at this file
you can make a new cell and use the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">!cat</span>&#160; <span class="pre">/usr/local/dat/leap/parm/parm19.dat</span></code></p>
<p>Here you will find the masses, bond distance and force constants etc. that make up our forcefield.</p>
<p>This produces the following output which are all force field parameters that are loaded.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----</span> <span class="n">Source</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">dat</span><span class="o">/</span><span class="n">leap</span><span class="o">/</span><span class="n">cmd</span><span class="o">/</span><span class="n">leaprc</span><span class="o">.</span><span class="n">protein</span><span class="o">.</span><span class="n">ff19SB</span>
<span class="o">-----</span> <span class="n">Source</span> <span class="n">of</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">dat</span><span class="o">/</span><span class="n">leap</span><span class="o">/</span><span class="n">cmd</span><span class="o">/</span><span class="n">leaprc</span><span class="o">.</span><span class="n">protein</span><span class="o">.</span><span class="n">ff19SB</span> <span class="n">done</span>
<span class="n">Log</span> <span class="n">file</span><span class="p">:</span> <span class="o">./</span><span class="n">leap</span><span class="o">.</span><span class="n">log</span>
<span class="n">Loading</span> <span class="n">parameters</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">dat</span><span class="o">/</span><span class="n">leap</span><span class="o">/</span><span class="n">parm</span><span class="o">/</span><span class="n">parm19</span><span class="o">.</span><span class="n">dat</span>
<span class="n">Reading</span> <span class="n">title</span><span class="p">:</span>
<span class="n">PARM99</span> <span class="o">+</span> <span class="n">frcmod</span><span class="o">.</span><span class="n">ff99SB</span> <span class="o">+</span> <span class="n">frcmod</span><span class="o">.</span><span class="n">parmbsc0</span> <span class="o">+</span> <span class="n">OL3</span> <span class="k">for</span> <span class="n">RNA</span> <span class="o">+</span> <span class="n">ff19SB</span>
<span class="n">Loading</span> <span class="n">parameters</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">dat</span><span class="o">/</span><span class="n">leap</span><span class="o">/</span><span class="n">parm</span><span class="o">/</span><span class="n">frcmod</span><span class="o">.</span><span class="n">ff19SB</span>
<span class="n">Reading</span> <span class="n">force</span> <span class="n">field</span> <span class="n">modification</span> <span class="nb">type</span> <span class="n">file</span> <span class="p">(</span><span class="n">frcmod</span><span class="p">)</span>
<span class="n">Reading</span> <span class="n">title</span><span class="p">:</span>
<span class="n">ff19SB</span> <span class="n">AA</span><span class="o">-</span><span class="n">specific</span> <span class="n">backbone</span> <span class="n">CMAPs</span> <span class="k">for</span> <span class="n">protein</span> <span class="mi">07</span><span class="o">/</span><span class="mi">25</span><span class="o">/</span><span class="mi">2019</span>
<span class="n">Loading</span> <span class="n">library</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">dat</span><span class="o">/</span><span class="n">leap</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">amino19</span><span class="o">.</span><span class="n">lib</span>
<span class="n">Loading</span> <span class="n">library</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">dat</span><span class="o">/</span><span class="n">leap</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">aminoct12</span><span class="o">.</span><span class="n">lib</span>
<span class="n">Loading</span> <span class="n">library</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">dat</span><span class="o">/</span><span class="n">leap</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">aminont12</span><span class="o">.</span><span class="n">lib</span>
</pre></div>
</div>
<p>In the next line, we set the radii of the atoms to be used for the implicit solvation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">default</span> <span class="n">PBradii</span> <span class="n">mbondi3</span>
</pre></div>
</div>
<p>This produces the following line in the leap output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Using</span> <span class="n">ArgH</span> <span class="ow">and</span> <span class="n">AspGluO</span> <span class="n">modified</span> <span class="n">Bondi2</span> <span class="n">radii</span>
</pre></div>
</div>
<p>Next, we create a new UNIT in AMBER using the <code class="docutils literal notranslate"><span class="pre">sequence</span></code> command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TRP</span> <span class="o">=</span> <span class="n">sequence</span> <span class="p">{</span>  <span class="n">NASN</span> <span class="n">LEU</span> <span class="n">TYR</span> <span class="n">ILE</span> <span class="n">GLN</span> <span class="n">TRP</span> <span class="n">LEU</span> <span class="n">LYS</span> <span class="n">ASP</span> <span class="n">GLY</span> <span class="n">GLY</span> <span class="n">PRO</span> <span class="n">SER</span> <span class="n">SER</span> <span class="n">GLY</span> <span class="n">ARG</span> <span class="n">PRO</span> <span class="n">PRO</span> <span class="n">PRO</span> <span class="n">CSER</span><span class="p">}</span>
</pre></div>
</div>
<p>Then, we save a PDB file of our system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">savepdb</span> <span class="n">TRP</span> <span class="n">trp_cage_linear</span><span class="o">.</span><span class="n">pdb</span>
</pre></div>
</div>
<p>This creates the pdb file on disk and produces the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Writing pdb file: trp_cage_linear.pdb

/usr/local/bin/teLeap: Warning!
 Converting N-terminal residue name to PDB format: NASN -&gt; ASN

/usr/local/bin/teLeap: Warning!
 Converting C-terminal residue name to PDB format: CSER -&gt; SER
Checking Unit.
</pre></div>
</div>
<p>As you can see, the N and C-terminal residues have a different residue namer in AMBER compared e.g to a normal serine. This is due to the fact that here the force field parameters slightly deviate from the parameters of a serine involved in two peptide bonds versus one single peptide bond for a terminal uncapped serine.</p>
<p>In the last step, we now generate the parameters in AMBER format and the input coordinates in the NetCDF format (which is a binary format).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">saveamberparm</span> <span class="n">TRP</span> <span class="n">trp_cage</span><span class="o">.</span><span class="n">prmtop</span> <span class="n">trp_cage_linear</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>This produces plenty of output and a warning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/usr/local/bin/teLeap: Warning!
The unperturbed charge of the unit (1.000000) is not zero.

/usr/local/bin/teLeap: Note.
Ignoring the warning from Unit Checking.

Building topology.
Building atom parameters.
Building bond parameters.
Building angle parameters.
Building proper torsion parameters.
Building improper torsion parameters.
 total 63 improper torsions applied
Building H-Bond parameters.
Incorporating Non-Bonded adjustments.
Not Marking per-residue atom chain types.
Marking per-residue atom chain types.
  (Residues lacking connect0/connect1 - 
   these don&#39;t have chain types marked:

	res	total affected

	CSER	1
	NASN	1
  )
 (no restraints)
</pre></div>
</div>
<p>The first warning we can safely ignore as in the implicit solvent treatment we will use, we cannot use counter ions to neutralize our system. Instead we will use a screened charge model to emulate the presence of ions in the solvent.
Next we see terms, that align with the functional form of the AMBER forcefield:</p>
<p><img alt="" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/fdc7cf40fe4d2f568921977c83e49f699d780e92" />
<img alt="" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/7c7949ed189c2add713405eb21fe5adcbda09ca0" />
<img alt="" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/2d244cd7f2e174af73dfc1e4dd0b37083115b690" /></p>
<p>Again, we can look at the contents of the parameter file <code class="docutils literal notranslate"><span class="pre">!cat</span> <span class="pre">trp_cage.prmtop</span></code> and we see that it does not contain the coordinates anymore in contrast to the pdb file.</p>
</div>
</div>
<div class="section" id="simulating-the-system">
<h2><span class="section-number">6.4.3. </span>Simulating the system<a class="headerlink" href="#simulating-the-system" title="Permalink to this headline">¶</a></h2>
<p>Now we can start the simulation by writing our simulation script in python.</p>
<p>First, lets import the required modules:</p>
<ul class="simple">
<li><p>openmm for running the simulation</p></li>
<li><p>parmed to read/write the input and output files</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># OpenMM Imports</span>
<span class="kn">import</span> <span class="nn">simtk.openmm</span> <span class="k">as</span> <span class="nn">mm</span>
<span class="kn">import</span> <span class="nn">simtk.openmm.app</span> <span class="k">as</span> <span class="nn">app</span>

<span class="c1"># ParmEd Imports</span>
<span class="kn">from</span> <span class="nn">parmed</span> <span class="kn">import</span> <span class="n">load_file</span><span class="p">,</span> <span class="n">unit</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">parmed.openmm</span> <span class="kn">import</span> <span class="n">StateDataReporter</span><span class="p">,</span> <span class="n">DCDReporter</span>

<span class="c1"># System modules</span>
<span class="kn">import</span> <span class="nn">sys</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="loading-amber-files">
<h3><span class="section-number">6.4.3.1. </span>Loading Amber files<a class="headerlink" href="#loading-amber-files" title="Permalink to this headline">¶</a></h3>
<p>In this stage, we simply instantiate the AmberParm object from the input topology and coordinate files. After this command, <code class="docutils literal notranslate"><span class="pre">trp_cage_gas</span></code> will contain a full description of every particle, the parameters defining their interactions, and their position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the Amber files</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading AMBER files...&#39;</span><span class="p">)</span>
<span class="n">trp_cage_gas</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="s1">&#39;trp_cage.prmtop&#39;</span><span class="p">,</span> <span class="s1">&#39;trp_cage_linear.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading AMBER files...
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-the-openmm-system">
<h3><span class="section-number">6.4.3.2. </span>Create the OpenMM System<a class="headerlink" href="#create-the-openmm-system" title="Permalink to this headline">¶</a></h3>
<p>This command creates an OpenMM <code class="docutils literal notranslate"><span class="pre">System</span></code> object from the information stored in
<code class="docutils literal notranslate"><span class="pre">trp_cage_gas</span></code>. It contains multiple <code class="docutils literal notranslate"><span class="pre">Force</span></code> instances for the bonds, angles,
periodic torsions, and nonbonded (electrostatic and van der Waals) interactions.
It is in this function that we define the potential parameters we want to use.
In this example, we have chosen the default values for each parameter except the
ones specified. In particular:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nonbondedMethod=app.NoCutoff</span></code> indicates we do not want to use a cutoff for nonbonded interactions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">constraints=app.HBonds</span></code> indicates we want to constrain all bonds in which at least one atom is a Hydrogen (i.e., SHAKE or SETTLE for water).  Other options are <code class="docutils literal notranslate"><span class="pre">None</span></code> (no constraints), <code class="docutils literal notranslate"><span class="pre">app.AllBonds</span></code>, or <code class="docutils literal notranslate"><span class="pre">app.HAngles</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">implicitSolvent=app.GBn2</span></code> indicates we want to use the second GBneck model described in Nguyen et al., J. Chem. Theory Comput., 2014 9(4) p.2020-2034.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">implicitSolventSaltConc=0.1*u.liters/u.mole</span></code> indicates we want to model a ca. 0.1 molar solution of monovalent ions using a Debye screening model.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the OpenMM system</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating OpenMM System&#39;</span><span class="p">)</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">trp_cage_gas</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">NoCutoff</span><span class="p">,</span>
                               <span class="n">constraints</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">HBonds</span><span class="p">,</span> <span class="n">implicitSolvent</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">GBn2</span><span class="p">,</span>
                               <span class="n">implicitSolventSaltConc</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">moles</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">liter</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating OpenMM System
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-the-integrator-to-do-langevin-dynamics">
<h3><span class="section-number">6.4.3.3. </span>Create the integrator to do Langevin Dynamics<a class="headerlink" href="#create-the-integrator-to-do-langevin-dynamics" title="Permalink to this headline">¶</a></h3>
<p>In this stage we specify an integrator. Common choices are
<code class="docutils literal notranslate"><span class="pre">LangevinIntegrator</span></code> (as we’ve chosen here) to do simulations in the NVT
ensemble.  In this
example, we’ve chosen the Langevin integrator with a target temperature of
300 K, a friction coefficient of 1/ps and a time step of 0.5 fs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the integrator to do Langevin dynamics</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span>
                        <span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>       <span class="c1"># Temperature of heat bath</span>
                        <span class="mf">1.0</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">,</span>  <span class="c1"># Friction coefficient</span>
                        <span class="mf">0.5</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="c1"># Time step</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-the-simulation-object">
<h3><span class="section-number">6.4.3.4. </span>Create the <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object<a class="headerlink" href="#create-the-simulation-object" title="Permalink to this headline">¶</a></h3>
<p>This step creates a <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object that will be used to run the actual
simulations.  OpenMM picks the fastest platform for us
if we do not specify a platform.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the Simulation object</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">trp_cage_gas</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">,)</span>
</pre></div>
</div>
</div>
</div>
<p>This stage is very important.  In this step, we set the particle positions
stored in the <code class="docutils literal notranslate"><span class="pre">trp_cage_gas</span></code> object to our object. If you omit this step, you can
get strange results or other errors like segmentation violations. These particle
positions have been parsed from the input coordinate file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the particle positions</span>
<span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">trp_cage_gas</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="minimize-the-energy">
<h3><span class="section-number">6.4.3.5. </span>Minimize the energy<a class="headerlink" href="#minimize-the-energy" title="Permalink to this headline">¶</a></h3>
<p>This stage performs a basic energy minimization to relax particle positions.
This particular invocation will perform at most 500 iterations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Minimize the energy</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimizing energy&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">(</span><span class="n">maxIterations</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">state</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">getPotentialEnergy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Minimizing energy
-3093.022096958216 kJ/mol
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="heating-phase">
<h3><span class="section-number">6.4.3.6. </span>Heating phase<a class="headerlink" href="#heating-phase" title="Permalink to this headline">¶</a></h3>
<p>After having obtained the minimized coordinates of our system we can begin slowly heating it.
We define reporters that will “report” on the status of the simulation
periodically throughout the heating phase. The first is a <code class="docutils literal notranslate"><span class="pre">StateDataReporter</span></code>
which will print out a summary of energies and temperatures every 500 steps.
This reporter directs the printout to standard output (the screen), <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> or to a file name (if set).</p>
<p>The second reporter is a NetCDF trajectory reporter, which is written in the
Amber NetCDF format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Heating phase&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StateDataReporter</span><span class="p">(</span><span class="s1">&#39;heating.csv&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">kineticEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 <span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
         <span class="n">DCDReporter</span><span class="p">(</span><span class="s1">&#39;trp_cage_heating.dcd&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">crds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">integrator</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="mi">65</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>  <span class="c1">## Change this in order to run 50 ps of heating in 5 steps</span>

<span class="n">state</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getPositions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">minimized_and_heated</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">getPositions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Heating phase
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;heating.csv&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential Energy (kilocalorie/mole)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Epot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Kinetic Energy (kilocalorie/mole)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ekin&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Energy (kilocalorie/mole)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Etot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t (ps)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kcal/mol)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/TRP_Cage_OpenMM_colab_30_0.svg" src="../_images/TRP_Cage_OpenMM_colab_30_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t (ps)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temp (K)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/TRP_Cage_OpenMM_colab_31_0.svg" src="../_images/TRP_Cage_OpenMM_colab_31_0.svg" /></div>
</div>
</div>
</div>
<div class="section" id="running-dynamics">
<h2><span class="section-number">6.4.4. </span>Running dynamics<a class="headerlink" href="#running-dynamics" title="Permalink to this headline">¶</a></h2>
<p>We first reset our Integrator to update the timestep, create the simulation object and then we actually run the MD of our heated system to see if our linear peptide folds up into its 3D form. We use again the <code class="docutils literal notranslate"><span class="pre">NetCDF</span></code> and <code class="docutils literal notranslate"><span class="pre">StateDataReporter</span></code> to retrieve information about our simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the integrator to do Langevin dynamics</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span>
                        <span class="mi">325</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>       <span class="c1"># Temperature of heat bath</span>
                        <span class="mf">1.0</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">,</span>  <span class="c1"># Friction coefficient</span>
                        <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="c1"># Time step</span>
<span class="p">)</span>

<span class="c1"># Create the Simulation object</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">trp_cage_gas</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>

<span class="c1"># Set the particle positions</span>
<span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">minimized_and_heated</span><span class="p">)</span>

<span class="c1"># Set up the reporters to report energies and coordinates every 50000 steps</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">StateDataReporter</span><span class="p">(</span><span class="s1">&#39;production.csv&#39;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">kineticEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># Additionally print to the output of the notebook, so that we can track the simulation.</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">StateDataReporter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">kineticEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">DCDReporter</span><span class="p">(</span><span class="s1">&#39;trp_cage_gb.dcd&#39;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">crds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Run dynamics</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running dynamics&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># change this to run 20 ns of simulation</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running dynamics
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting energy from production simulation</span>

<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;production.csv&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential Energy (kilocalorie/mole)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Epot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Kinetic Energy (kilocalorie/mole)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ekin&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total Energy (kilocalorie/mole)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Etot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t (ps)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kcal/mol)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/TRP_Cage_OpenMM_colab_35_0.svg" src="../_images/TRP_Cage_OpenMM_colab_35_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average temperature&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> +- </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average temperature
83.891 +- 55.240 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t (ps)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temp (K)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/TRP_Cage_OpenMM_colab_37_0.svg" src="../_images/TRP_Cage_OpenMM_colab_37_0.svg" /></div>
</div>
</div>
<div class="section" id="save-trajectory-for-later-processing">
<h2><span class="section-number">6.4.5. </span>Save trajectory for later processing<a class="headerlink" href="#save-trajectory-for-later-processing" title="Permalink to this headline">¶</a></h2>
<p>Now we zip the files and upload the files to a filesharing provider to download them again on noto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>zip archive.zip trp_cage* production.csv heating.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upload</span>
<span class="n">response</span> <span class="o">=</span> <span class="o">!</span>curl -F <span class="s2">&quot;file=@archive.zip&quot;</span> https://file.io

<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;use this code on noto in the analysis notebook: &quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">6</span><span class="p">])[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something went wrong, check the name of the file and check the response&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Ex6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="proteinmodelling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">6.3. </span>Protein Modelling</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="hydrogenbonds.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6.5. </span>TrpCage Analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Simon Duerr, Sophie Johnson, Irea Mosquera, Andrea Levy,  Ursula Roethlisberger<br/>
        
          <div class="extra_footer">
            <div class="container-lg mt-3 footer"> <div class="row"> <div class="col-xl-9 d-flex"> <div class="container"> <div class="row"> <div class="col-6 d-flex" style="justify-content:center"> <a href="https://lcbc.epfl.ch"> Laboratory of Computational Biochemistry and Chemistry</a></li>
</div> <div class="col-6 d-flex" style="justify-content:center"> <ul style="list-style:none"> <li> <a href="https://github.com/lcbc-epfl/iesm-public">GitHub </a> </li> </li> <!--<li> <a href="https://doi.org/10.5281/zenodo.0000000"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.00000000.svg" alt="DOI"></a> </li>--> </ul> </div> </div> </div> </div> <div class="col-xl-3"> <a href="https://epfl.ch"><img src="https://www.epfl.ch/wp/5.5/wp-content/themes/wp-theme-2018/assets/svg/epfl-logo.svg?refresh=now" alt="EPFL Logo" style="padding:5px;height:33px;"></a> </div> </div> </div> <div class="row_footer my-3"> Dual licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons Attribution Share Alike 4.0 International</a> (CC BY SA 4.0) and MIT license. (Except where indicated otherwise) </div>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>